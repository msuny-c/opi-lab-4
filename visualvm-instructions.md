# Инструкция по использованию VisualVM для мониторинга и профилирования

## Установка VisualVM

1. Скачайте VisualVM с официального сайта: https://visualvm.github.io/download.html
2. Распакуйте архив в любую удобную директорию.
3. Запустите VisualVM через скрипт запуска (visualvm.exe в Windows или visualvm в Linux/macOS).

## Подключение к приложению

1. Убедитесь, что ваше приложение запущено.
2. В левой панели VisualVM найдите раздел "Local", где будут отображаться запущенные Java-приложения.
3. Найдите ваше приложение в списке (обычно отображается как "app.war" или содержит имя вашего main-класса).
4. Дважды щелкните на приложении, чтобы подключиться к нему.

## Мониторинг MBean-объектов

1. После подключения к приложению перейдите на вкладку "MBeans" (возможно, вам потребуется установить плагин VisualVM-MBeans из центра плагинов VisualVM).
2. В дереве MBean найдите и разверните раздел "ru.itmo.app.mbean".
3. Разверните узлы для ваших MBean-классов:
   - PointStatistics
   - ClickInterval

## Снятие графика изменения показаний MBean

1. Щелкните правой кнопкой мыши на атрибуте MBean-объекта, например, "totalPoints" в PointStatisticsMBean.
2. Выберите опцию "Visualize" или "Plot Chart" в контекстном меню.
3. Появится график, отображающий изменение значения этого атрибута с течением времени.
4. Вы можете добавить несколько атрибутов на один график для сравнения:
   - Щелкните правой кнопкой на другом атрибуте (например, "pointsInArea")
   - Выберите "Add to Chart" для добавления на существующий график

5. Для наблюдения за изменениями, взаимодействуйте с приложением (добавляйте точки).

## Определение потока, потребляющего наибольший процент CPU

1. Перейдите на вкладку "Monitor" для общего просмотра активности приложения.
2. Затем перейдите на вкладку "Threads" для просмотра активности потоков.
3. Обратите внимание на колонку "CPU Usage", которая показывает использование CPU каждым потоком.
4. Для более детального анализа вкладка "Sampler" или "Profiler" позволяет получить точные данные:
   - Перейдите на вкладку "Sampler" или "Profiler"
   - Выберите опцию "CPU"
   - Нажмите кнопку "Start" для начала сбора данных
   - После некоторого времени работы приложения нажмите "Stop"
   - В результатах будут отображены потоки и методы, потребляющие наибольший процент CPU

## Профилирование памяти

1. Перейдите на вкладку "Sampler" или "Profiler".
2. Выберите опцию "Memory".
3. Нажмите кнопку "Start" для начала сбора данных.
4. Выполните операции в приложении.
5. Нажмите "Stop" для завершения сбора данных.
6. Проанализируйте результаты, которые покажут, какие объекты занимают наибольшее количество памяти.

## Локализация проблем с производительностью

1. Перейдите на вкладку "Profiler".
2. Начните с профилирования CPU:
   - Выберите "CPU" в опциях профилирования
   - Выберите "Sample" для статистического анализа или "Instrument" для точного инструментального анализа
   - Нажмите "Start" для начала профилирования
   - Выполните действия в приложении, особенно те, которые кажутся медленными
   - Нажмите "Stop" для завершения профилирования
   - Проанализируйте горячие точки в коде (методы, потребляющие наибольшее время CPU)

3. Проанализируйте использование памяти:
   - Выберите "Memory" в опциях профилирования
   - Нажмите "Start" для начала профилирования
   - Выполните действия в приложении
   - Нажмите "Stop" для завершения профилирования
   - Проанализируйте объекты, занимающие наибольшее количество памяти
   - Обратите внимание на возможные утечки памяти (объекты, которые накапливаются и не освобождаются)

4. Сделайте скриншоты обнаруженных проблем для отчета.

## Советы по использованию VisualVM

1. Для сохранения снимков приложения для последующего анализа используйте File > Save Application.
2. Сравнение снимков (снятых в разные моменты времени) помогает выявить изменение потребления ресурсов.
3. Используйте фильтры в профилировщике для фокусировки на конкретных пакетах вашего приложения.
4. При профилировании ограничьте другую активность на компьютере для получения более точных результатов.
5. Для регулярного мониторинга используйте опцию "Take Snapshot" для сохранения состояния приложения в конкретный момент времени. 